<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>



    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/colreorder/1.5.2/css/colReorder.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/keytable/2.5.1/css/keyTable.dataTables.min.css">



    <!-- Bootstrap core CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <!-- Material Design Bootstrap -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.8.11/css/mdb.min.css" rel="stylesheet">

    <!-- JQuery -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/colreorder/1.5.2/js/dataTables.colReorder.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/keytable/2.5.1/js/dataTables.keyTable.min.js"></script>



    <!-- Bootstrap tooltips -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.4/umd/popper.min.js"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <!-- MDB core JavaScript -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.8.11/js/mdb.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-functions.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-database.js"></script>

    <script src="https://www.gstatic.com/firebasejs/5.8.6/firebase.js"></script>
    <link rel="stylesheet" href="main.css">

</head>

<body>
    <div class="container-fluid">
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="user-tab" data-toggle="tab" href="#user" role="tab" aria-controls="user" aria-selected="true">Users</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="transactions-tab" data-toggle="tab" href="#transaction" role="tab" aria-controls="transaction" aria-selected="false">Transactions</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="checkout-tab" data-toggle="tab" href="#checkout" role="tab" aria-controls="checkout" aria-selected="false">Chekouts</a>
            </li>
        </ul>
    </div>
    <div id="modul-container" style="display:none;"></div>
    <div class="tab-pane fade show active" id="user" role="tabpanel" aria-labelledby="user-tab">
        <table id="dtBasicExample" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
            <thead>
                <tr>
                    <th class="th-sm">Id
                    </th>
                    <th class="th-sm">userAvatar
                    </th>
                    <th class="th-sm">userEmail
                    </th>
                    <th class="th-sm">Name
                    </th>
                    <th class="th-sm">userDescr
                    </th>
                    <th class="th-sm">userWalletStatus
                    </th>
                    <th class="th-sm">userTransactions
                    </th>
                    <th class="th-sm">walletAmount
                    </th>
                    <th class="th-sm">userWalletStartDate
                    </th>
                    <th class="th-sm">userWalletEndDate
                    </th>
                    <th class="th-sm">userWalletDistributed
                    </th>
                    <th class="th-sm">walletAction
                    </th>
                </tr>
            </thead>
            <tbody id="table-container">


            </tbody>
            <tfoot>
                <tr>
                    <th class="th-sm">Id
                    </th>
                    <th class="th-sm">userAvatar
                    </th>
                    <th class="th-sm">userEmail
                    </th>
                    <th class="th-sm">Name
                    </th>
                    <th class="th-sm">userDescr
                    </th>
                    <th class="th-sm">userWalletStatus
                    </th>
                    <th class="th-sm">userTransactions
                    </th>
                    <th class="th-sm">walletAmount
                    </th>
                    <th class="th-sm">userWalletStartDate
                    </th>
                    <th class="th-sm">userWalletEndDate
                    </th>
                    <th class="th-sm">userWalletDistributed
                    </th>
                    <th class="th-sm">walletAction
                    </th>
                </tr>
            </tfoot>
        </table>
    </div>
    <div class="tab-pane fade" id="transaction" role="tabpanel" aria-labelledby="transactions-tab">
        <table id="dtBasicExample2" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
            <thead>
                <tr>
                    <th class="th-sm">AuthorId
                    </th>
                    <th class="th-sm">AuthorKey
                    </th>
                    <th class="th-sm">URL
                    </th>
                    <th class="th-sm">titre
                    </th>
                    <th class="th-sm">#transactions
                    </th>
                    <th class="th-sm">#comments
                    </th>

                </tr>
            </thead>
            <tbody id="table-container2">


            </tbody>
            <tfoot>
                <tr>
                    <th class="th-sm">AuthorId
                    </th>
                    <th class="th-sm">AuthorKey
                    </th>
                    <th class="th-sm">URL
                    </th>
                    <th class="th-sm">titre
                    </th>
                    <th class="th-sm">#transactions
                    </th>
                    <th class="th-sm">#comments
                    </th>

                </tr>
            </tfoot>
        </table>
    </div>

    <div class="tab-pane fade" id="checkout" role="tabpanel" aria-labelledby="checkout-tab">
        <table id="dtBasicExample3" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
            <thead>
                <tr>
                    <th class="th-sm">AuthorId
                    </th>
                    <th class="th-sm">Name
                    </th>
                    <th class="th-sm">Mail
                    </th>
                    <th class="th-sm">Bank
                    </th>
                    <th class="th-sm">Janvier
                    </th>
                    <th class="th-sm">Février
                    </th>
                    <th class="th-sm">Mars
                    </th>
                    <th class="th-sm">Avril
                    </th>
                    <th class="th-sm">Mai
                    </th>
                    <th class="th-sm">Juin
                    </th>
                    <th class="th-sm">Juillet
                    </th>
                    <th class="th-sm">Aout
                    </th>
                    <th class="th-sm">Septembre
                    </th>
                    <th class="th-sm">Octobre
                    </th>
                    <th class="th-sm">Novembre
                    </th>
                    <th class="th-sm">Décembre
                    </th>

                </tr>
            </thead>
            <tbody id="table-container3">


            </tbody>
            <tfoot>
                <tr>
                    <th class="th-sm">AuthorId
                    </th>
                    <th class="th-sm">Name
                    </th>
                    <th class="th-sm">Mail
                    </th>
                    <th class="th-sm">Bank
                    </th>
                    <th class="th-sm">Janvier
                    </th>
                    <th class="th-sm">Février
                    </th>
                    <th class="th-sm">Mars
                    </th>
                    <th class="th-sm">Avril
                    </th>
                    <th class="th-sm">Mai
                    </th>
                    <th class="th-sm">Juin
                    </th>
                    <th class="th-sm">Juillet
                    </th>
                    <th class="th-sm">Aout
                    </th>
                    <th class="th-sm">Septembre
                    </th>
                    <th class="th-sm">Octobre
                    </th>
                    <th class="th-sm">Novembre
                    </th>
                    <th class="th-sm">Décembre
                    </th>


                </tr>
            </tfoot>
        </table>
        <button id="precalculate" onclick="preCalculate()">Precalculate</button>
    </div>

</body>
<script src="./scripts.js"></script>
<script>
    $(document).ready(function() {



        $("#transactions-tab").click(function() {
            setTimeout(function() {
                $("#dtBasicExample_wrapper").hide()
                $("#transaction").show()

            }, 1000)
        });
        $("#user-tab").click(function() {
            setTimeout(function() {
                $("#dtBasicExample_wrapper").show()
            }, 1000)
        });
        $("#checkout-tab").click(function() {
            setTimeout(function() {
                $("#dtBasicExample_wrapper").hide()
                $("#transaction").hide()

            }, 1000)
        });
        setTimeout(function() {
            $(".transactions").on('click', function(event) {
                $("#modul-container").html('')
                $("#modul-container").html(' <table id="dtTransperAuther" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%"><thead><tr><th class="th-sm">photoURL</th><th class="th-sm">displayName</th><th class="th-sm">email</th><th class="th-sm">walletAmount</th><th class="th-sm">For This</th></tr></thead><tbody id="trans-container"></tbody><tfoot><tr><th class="th-sm">photoURL</th><th class="th-sm">displayName</th><th class="th-sm">email </th><th class="th-sm">walletAmount</th><th class="th-sm">For This</th></tr></tfoot></table>')
                $("#modul-container").show()

                event.stopPropagation();
                event.stopImmediatePropagation();
                var contentArray = $(this).parent().children('td')
                var AuthorId = contentArray[0].innerHTML;
                var AuthorKey = contentArray[1].innerHTML;
                var URL = contentArray[2].innerHTML;
                var transRef = firebase.database().ref('transactions/' + AuthorKey + '/' + URL + '/cTransactions')

                transRef.once("value").then(function(snoip) {
                    const trans = snoip.val()
                    const keys = Object.keys(trans)
                    for (const key of keys) {
                        var date = trans[key]
                        var user = firebase.database().ref('users/' + key)
                        var div2 = document.getElementById("trans-container")

                        user.once("value").then(function(sip) {
                            var userEmail = sip.val().email
                            var userName = sip.val().displayName
                            var userAvatar = sip.val().photoURL
                            var walletAmount = parseInt(sip.val().wallet.amount)
                            var numTransactions = parseInt(Object.keys(sip.val().transactions).length)


                            var forThis = walletAmount / numTransactions
                            div2.innerHTML += '<tr><td class="userAvatar"><img class="avatar-img" src="' + userAvatar + '"></td><td class="userName">' + userName + '</td><td class="userEmail">' + userEmail + '</td><td class="walletAmount">' + walletAmount + '</td><td class="forThis">' + forThis + '</td></tr>'
                        })
                    }
                })
            });
            $('#dtBasicExample').DataTable({
                colReorder: true,
                keys: true,
                "ordering": true
            });
            $('#dtBasicExample2').DataTable({
                colReorder: true,
                keys: true,
                "ordering": true
            });
            $('#dtBasicExample3').DataTable({
                colReorder: true,
                keys: true,
                "ordering": true
            });
            $('.dataTables_length').addClass('bs-select');

        }, 2000);
    })
</script>

</html>